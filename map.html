<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>チャレンジ用マップ（埼玉大学→皇居→フジテレビ）</title>
  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <!-- Leaflet Routing Machine -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css"
  />
  <style>
    :root {
      --brand: #1a3d66;
      --panel-bg: #ffffff;
    }
    html, body { height: 100%; margin: 0; }
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif; background:#e6f2fa; }
    header {
      padding: 14px 16px;
      background: var(--brand);
      color: #fff;
      font-weight: 800;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    #map { height: calc(100% - 60px); }
    .leaflet-routing-container { background: var(--panel-bg); border-radius: 12px; }
    .topbar {
      display:flex; gap:10px; align-items:center; justify-content:space-between;
    }
    .title { font-size: 18px; }
    .btn {
      background:#fff; color:var(--brand); border:1px solid rgba(255,255,255,0.6);
      padding:8px 12px; border-radius:10px; text-decoration:none; font-weight:700;
    }
    .btn:hover { background:#f7faff; }
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <div class="title">最短ルート：埼玉大学 → 皇居 → フジテレビ</div>
      <nav>
        <a class="btn" href="challenge2.html">← 第2回ページに戻る</a>
      </nav>
    </div>
  </header>
  <div id="map"></div>

  <!-- Scripts -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
  <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.min.js"></script>
  <script>
    // 目印の座標（おおよその位置）
    const SAITAMA_UNIV = L.latLng(35.8606, 139.6090);   // 埼玉大学
    const IMPERIAL_PAL  = L.latLng(35.6852, 139.7528);   // 皇居（外苑付近）
    const FUJI_TV       = L.latLng(35.6268, 139.7759);   // フジテレビ（お台場）

    // 地図
    const map = L.map('map', {
      zoomControl: true,
      scrollWheelZoom: true
    });

    // タイル（OpenStreetMap）
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // ルーティング（OSRM 無料デモサーバ）
    const control = L.Routing.control({
      waypoints: [SAITAMA_UNIV, IMPERIAL_PAL, FUJI_TV],
      router: L.Routing.osrmv1({
        serviceUrl: 'https://router.project-osrm.org/route/v1'
        // OSRM は既定で「最速」寄りのルートですが、都市部では概ね最短と近い経路になります
      }),
      lineOptions: {
        addWaypoints: false,
        styles: [
          { color: '#ffffff', opacity: 0.9, weight: 9 },
          { color: '#1a3d66', opacity: 0.9, weight: 5 }
        ]
      },
      altLineOptions: { styles: [{ color: '#99b3cc', opacity: 0.7, weight: 5 }] },
      showAlternatives: false,
      routeWhileDragging: false,
      collapsible: true,
      show: true,
      language: 'ja'
    }).addTo(map);

    // マーカーとポップアップ
    L.marker(SAITAMA_UNIV).addTo(map).bindPopup('埼玉大学（出発）');
    L.marker(IMPERIAL_PAL).addTo(map).bindPopup('皇居（経由）');
    L.marker(FUJI_TV).addTo(map).bindPopup('フジテレビ（到着）');

    // ルート計算後に地図範囲をフィット
    control.on('routesfound', (e) => {
      const route = e.routes[0];
      const bounds = L.latLngBounds();
      route.coordinates.forEach(c => bounds.extend(c));
      map.fitBounds(bounds, { padding: [30, 30] });
    });

    // 初期は3点を含む範囲にフィット
    map.fitBounds(L.latLngBounds([SAITAMA_UNIV, IMPERIAL_PAL, FUJI_TV]), { padding: [30,30] });
  </script>
</body>
</html>
